@using Microsoft.AspNetCore.Identity;
@using WebAnimalPassport.Models.Data;

@inject SignInManager<CustomUser> SignInManager
@inject UserManager<CustomUser> UserManager

@model Animal
@{
    ViewData["Title"] = $"Питомец - {Model.Name}";
    bool canModify = SignInManager.IsSignedIn(User) && UserManager.GetUserId(User) == Model.User.Id;
}

<div class="d-flex justify-content-center">
    <h1 class="border border border-dark rounded p-4">@ViewData["Title"]</h1>
</div>
<h1 class="text-center">Владелец питомца</h1>
<hr>
<div class="d-flex justify-content-around">
    <div class="d-flex flex-column">
        <h5>Имя - Name</h5>
        <p>@Model.User.Name</p>
        <h5>Фамилия - Surname</h5>
        <p>@Model.User.Surname</p>
        <h5>Адрес</h5>
        <p>@Model.User.Address</p>
        <h5>Период опеки</h5>
        <p>
            @if (Model.Owners.Count == 0)
            {
                @Model.BirthDate.ToString("dd.MM.yyyy") @:- @(Model.DeathDate?.ToString("dd.MM.yyyy") ?? "наст.вр.")
            }
            else
            {
                @Model.Owners.Last().TransmitDate.ToString("dd.MM.yyyy") @:- @(Model.DeathDate?.ToString("dd.MM.yyyy") ?? "наст.вр.")
            }
        </p>
    </div>
    <div class="d-flex flex-column">
        <h5>Индекс - Post-code</h5>
        <p>@(Model.User.Index ?? "Не указан")</p>
        <h5>Город - City</h5>
        <p>@Model.User.City</p>
        <h5>Регион - Region</h5>
        <p>@(Model.User.City ?? "Не указан")</p>
        <h5>Страна - Country</h5>
        <p>@(Model.User.Country ?? "Не указана")</p>
    </div>
</div>
<h1 class="text-center">Заводчик питомца</h1>
<hr>
<div class="d-flex justify-content-around">
    <div class="d-flex flex-column">
        <h5>Имя - Name</h5>
        <p>@Model.InitialUser.Name</p>
        <h5>Фамилия - Surname</h5>
        <p>@Model.InitialUser.Surname</p>
        <h5>Адрес</h5>
        <p>@Model.InitialUser.Address</p>
        <h5>Период опеки</h5>
        <p>
            @if (Model.Owners.Count == 0)
            {
                @Model.BirthDate.ToString("dd.MM.yyyy") @:- @(Model.DeathDate?.ToString("dd.MM.yyyy") ?? "наст.вр.")
            }
            else
            {
                @Model.BirthDate.ToString("dd.MM.yyyy") @:- @Model.Owners.First().TransmitDate.ToString("dd.MM.yyyy")
            }
        </p>
    </div>
    <div class="d-flex flex-column">
        <h5>Индекс - Post-code</h5>
        <p>@(Model.InitialUser.Index ?? "Не указан")</p>
        <h5>Город - City</h5>
        <p>@Model.InitialUser.City</p>
        <h5>Регион - Region</h5>
        <p>@(Model.InitialUser.City ?? "Не указан")</p>
        <h5>Страна - Country</h5>
        <p>@(Model.InitialUser.Country ?? "Не указана")</p>
    </div>
</div>
<h1 class="text-center">Описание питомца</h1>
<hr>
<div class="row justify-content-around">
    <div class="col-12 col-sm-6 col-lg-3">
        @if (Model.PhotoPath != null)
        {
            <img class="rounded-custom w-100 h-100" src="~/src/Animals/@Model.PhotoPath">
        }
        else
        {
            @switch (Model.Type)
            {
                case AnimalType.Cat:
                    <img class="rounded-custom w-100 h-100" src="~/src/Stocks/cat.svg">
                    break;
                case AnimalType.Dog:
                    <img class="rounded-custom w-100 h-100" src="~/src/Stocks/dog.svg">
                    break;
            }
        }
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
        <h5>Кличка - Name</h5>
        <p>@Model.Name</p>
        <h5>Вид - Species</h5>
        <p>@Model.Type.GetDisplayName()</p>
        <h5>Порода - Breed</h5>
        <p>@Model.Breed</p>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
        <h5>Пол - Sex</h5>
        <p>@Model.Sex.GetDisplayName()</p>
        <h5>Дата рождения - Date of birth</h5>
        <p>@Model.BirthDate.ToString("dd.MM.yyyy")</p>
        <h5>Шерсть - Hair</h5>
        <p>@Model.Hair</p>
    </div>
</div>
<h1 class="text-center">Идентификация питомца</h1>
<hr>
<div class="d-flex justify-content-around">
    <div class="d-flex flex-column">
        <h5>Микрочип номер - Microchip number</h5>
        <p>@(Model.ChipNumber ?? "Не указано")</p>
        <h5>Дата чипирования - Date of Microchiping</h5>
        <p>@(Model.ChipDate?.ToString("dd.MM.yyyy") ?? "Не указано")</p>
        <h5>Расположение микрочипа - Microchip location</h5>
        <p>@(Model.ChipLocation ?? "Не указано")</p>
    </div>
    <div class="d-flex flex-column">
        <h5>Клеймо - Tattoo number</h5>
        <p>@(Model.TattoNumber ?? "Не указано")</p>
        <h5>Дата клеймения - Date of Tattooing</h5>
        <p>@(Model.TattoDate?.ToString("dd.MM.yyyy") ?? "Не указано")</p>
    </div>
</div>
<hr>
<div class="accordion accordion-flush">
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-1" aria-controls="collapse-1"><h4 class="p-0 m-0">Вакцинации</h4></button>
        </h2>
        <div id="collapse-1" class="accordion-collapse collapse" aria-expanded="false">
            <div class="accordion-body">
                <table class="table w-100">
                    <thead>
                        <tr class="cell-centered">
                            @if (canModify)
                            {
                                <td>Действия</td>
                            }
                            <td class="text-nowrap">№ п/п</td>
                            <td>Вид вакцины</td>
                            <td>№ серии</td>
                            <td>Дата вакцинации</td>
                            <td>Дейстивительна до</td>
                            <td>Ветеринарный врач</td>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.Vaccinations.Count; i++)
                        {
                            var vaccine = Model.Vaccinations[i];
                            <tr class="cell-centered">
                                @if (canModify)
                                {
                                    <td><a class="btn btn-sm btn-warning" asp-controller="Vaccination" asp-action="Edit" asp-route-id="@vaccine.Id">Изменить</a></td>
                                }
                                <td>@(i + 1)</td>
                                <td>@vaccine.Type</td>
                                <td>@vaccine.Series</td>
                                <td>@vaccine.StartDate.ToString("dd.MM.yyyy")</td>
                                <td>@vaccine.EndDate.ToString("dd.MM.yyyy")</td>
                                <td>
                                    @if (vaccine.Doctor == null)
                                    {
                                        @vaccine.DoctorName
                                    }
                                    else
                                    {
                                        @vaccine.Doctor.Surname @vaccine.Doctor.Name @vaccine.Doctor.Patronymic
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                @if (canModify)
                {
                    <a class="btn btn-success w-100" asp-controller="Vaccination" asp-action="Create" asp-route-id="@Model.Id">Добавить вакцинацию</a>
                }
            </div>
        </div>
    </div>
</div>
<hr>
<div class="accordion accordion-flush">
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-2" aria-controls="collapse-2"><h4 class="p-0 m-0">Обработки</h4></button>
        </h2>
        <div id="collapse-2" class="accordion-collapse collapse" aria-expanded="false">
            <div class="accordion-body">
            </div>
        </div>
    </div>
</div>

@if (canModify)
{
    <h1 class="text-center">Действия</h1>
    <hr>
    <a class="btn btn-warning w-100 mb-1" asp-controller="Animal" asp-action="Edit" asp-route-id="@Model.Id">Редактировать</a>
    <a class="btn btn-danger w-100 mb-1" asp-controller="Animal" asp-action="Transmit" asp-route-id="@Model.Id">Передать другому пользователю</a>
    <a class="btn btn-danger w-100 mb-1" asp-controller="Animal" asp-action="Lost" asp-route-id="@Model.Id">Заявить о потере</a>
    <a class="btn btn-dark text-danger mb-1 w-100" asp-controller="Animal" asp-action="Death" asp-route-id="@Model.Id">Заявить о смерти</a>
}